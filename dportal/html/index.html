#html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{welcome_text}</title>
    <script src="{root}jslib/jquery.js"></script>
    <script src="{root}jslib/chosen.jquery.min.js"></script>
    <script src="{root}jslib/jquery.flexslider-min.js"></script>
    <script src="{root}jslib/d3.min.js"></script>
    <link href="{root}art/chosen.min.css" rel="stylesheet" type="text/css">
    <link href="{root}art/flexslider.css" rel="stylesheet" type="text/css">
    <link href="{root}art/index.css" rel="stylesheet" type="text/css">
    {ganal}
</head>
<body>
{jsmenu}
<div class="portal">
    <div class="main_wrap">
        <div class="overlay">
            <div class="default index">
                <nav>
                    <div class="menu-wrap">
                        <div class="img-wrap">
                            <img class="logo-img" src="{root}art/UNDG_logo.png" alt="UNDG logo"/>
                        </div>
                        <div class="menu-link-wrap">
                            <div class="menu">

                                <a href="about.html">
                                    <span>{about_text}</span>
                                    <!--<span class="path_txt">{install_info_text}</span>-->
                                </a>
                            </div>
                            <div class="menu">
                                <a href="/ctrack.html#view=generator">
                                    <span>{install_button_text}</span>
                                    <!--<span class="path_txt">{install_info_text}</span>-->
                                </a>
                            </div>
                            <!--<div class="menu">-->
                                <!--<a href="#explore">-->
                                    <!--&lt;!&ndash;<span class="path_txt">{explore_info_text}</span>&ndash;&gt;-->
                                <!--</a>-->
                            <!--</div>-->
                            <div class="menu">
                                <a href="https://github.com/devinit/D-Portal/issues" target="_blank">
                                    <span>{develop_button_text}</span>
                                    <!--<span class="path_txt">{develop_info_text}</span>-->
                                </a>
                            </div>
                        </div>
                    </div>
                </nav>
                <div class="tongue_wrap">{tongue_select}</div>
                <div class="tag">{tagline_text}</div>
                <div class="chart-wrap">
                    <div class="chart-item">
                        <span class="title">{total_projects_text}</span>

                        <div id="total_projects_shown"></div>
                        <div id="">{active_projects_text}</div>
                        <div id="progressBox">
                            <div id="progressBar"><span id="display-active-projects"></span></div>

                        </div>

                    </div>
                    <div class="chart-item">
                        <span class="title">{total_budget_text}</span>

                        <div id="totalBudget"></div>
                        <span class="title">Total Expenses</span>

                        <div id="totalExpense"></div>
                        <div id="pie1">
                            <span>top</span>
                            <span>bottom</span>
                        </div>
                    </div>
                    <div class="chart-item">
                        <span class="title">{un_agencies_in_iati_text}</span>

                        <div id="un_agencies_in_iati"></div>
                        <div id="progressBox2">
                            <div id="progressBar2"><span id="display-un-agencies"></span></div>

                        </div>

                    </div>
                    <div class="chart-item">
                        <span class="title">{countries_un_operates}</span>

                        <div id="no_of_countries"></div>
                        <div id="worldMap"></div>
                    </div>

                    <div class="chart-item">
                        <span class="title">{trend_of_activities}</span>

                        <div id="linegraph"></div>
                    </div>
                </div>
                <div class="description_wrap">
                    <div class="description">
                        <span class="title">{index_title_text}</span>

                        <p><span class="bold">d-portal.org</span> {index_paragraph1_text}</p>

                        <p>{index_paragraph2_text}</p>
                    </div>
                    <div class="description">
                        <span class="title">{links_title_text}</span>
                        <a href="{tongue_root}news/posts.html" class="read">&gt; {news_page_text}</a>
                        <a href="{tongue_root}about.html" class="read">&gt; {read_more_text}</a>
                        <span class="title">{explore_title_text}</span>

                        <p><b>{explore_paragraph1_text}</b></p>

                        <p>{explore_paragraph2_text}</p>
                    </div>
                </div>
                <span id="explore"></span>
            </div>
            <div class="agencies_wrap">
                <div class="agencies">
                    <h2>{members_and_observers_text}<a class="link-to-members" href="https://undg.org/home/about-undg/members/">{learn_more_about_members}</a></h2>

                    <div class="flexslider">
                      {loading}
                        <ul id="un_publisher_list" class="country_menu_list slides"></ul>
                    </div>
                </div>
            </div>
            <div class="compare_detail_wrap">
                <div class="compare_list">
                    <div class="compare">
                        <a class="path" href="{root}ctrack.html?tongue={tongue}#view=publisher_countries">
                            <span class="select_wrap full">{all_countries_text}</span>
                        </a>
                    </div>
                    <div class="compare">
                        <a class="path" href="{root}ctrack.html?tongue={tongue}#view=publishers">
                            <span class="select_wrap full">{all_agencies_text}</span>
                        </a>
                    </div>
                    <div class="compare">
                        <a class="path" href="{root}ctrack.html?tongue={tongue}#view=publisher_sectors">
                            <span class="select_wrap full">{all_sector_text}</span>
                        </a>
                    </div>
                </div>
                <div class="country_menu_list_wrap">
                    <div id="country_dropmenu"></div>
                    <div id="sector_dropmenu"></div>
                    <div class="menu_list_wrap left">
                        <ul id="country_menu_list" class="country_menu_list"></ul>
                    </div>
                    <div class="menu_list_wrap">
                        <ul id="sector_list" class="country_menu_list"></ul>
                    </div>
                </div>
                <div class="sustainable_wrap">
                    <img src="{root}art/ic_sustainable_goal.png" alt="">

                    <div class="sustable_img">
                        <img src="{root}art/sustanable_img.png" alt="">
                    </div>
                </div>
                <div class="data_description_wrap">

                    <h2>
                        Where is the data from?
                    </h2>

                    <p>
                        Data in the dropdown menu is built from the database which updates everyday at GMT +0 with new
                        data fetched from the IATI Registry.
                    </p>

                    <p>
                        We list countries that are reported by publishers using ISO3166 Alpha-2. For attribution and
                        links to data sources, go here.
                    </p>

                    <p>
                        The list of publishers with their IATI publisher ID comes straight from the IATI Registry
                        database.
                        The dropdown list of publishers comes from published XML activities reported by these
                        publishers.
                    </p>
                </div>
            </div>
            <div class="description_wrap">
                <div class="description full">
                    <span class="title">{index_title2_text}</span>

                    <p>{index_paragraph3_text}</p>

                    <p>{index_paragraph4_text}</p>

                    <p>{index_paragraph5_text}</p>

                    <p>{index_paragraph6_text}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="footer_wrap">
        <div class="footer">
            <div class="footer_link">
                <a href="mailto:support@iatistandard.org" title="{footer1_tip_text}">{footer1_text}</a>
            </div>
            <div class="footer_link top_about_wrap">
                <!--<div class="top"><a onclick="$('html,body').animate({scrollTop:0},'slow');return false;">-->
                <!--{footer2_text}</a>-->
                <!--</div>-->
                <div class="about">
                    <a href="{tongue_root}about.html">{footer3_text}</a>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="{root}jslib/progressBar1.js"></script>
<script src="{root}jslib/progressBar2.js"></script>
<script src="{root}jslib/budgetPie.js"></script>
<script src="{root}jslib/orgCompPie.js"></script>
<script src="{root}jslib/unMap.js"></script>
<script src="{root}jslib/trendChart.js"></script>
</body>
</html>

#beige
<div class="beigealert_wrap">
    <div class="beigealert"><img src="{root}art/alert_icon.png" alt="Alert icon" width="15" height="15"> d-portal.org is
        currently in BETA.
    </div>
</div>

#country_select
<li>
    <a class="country_code" href="{root}ctrack.html?country={it.id}&tongue={tongue}">
		<span class="select_wrap">
			<img src="{root}art/flag/{it.cc}.png" alt="{it.name} {flag_alt_text}"/>
		</span><span class="select_wrap countryid">
			{it.id}
		</span><span class="select_wrap countryname">
			{it.name}
		</span>
    </a>
</li>

#loading
<div class="spinner"></div>
<!-- #publisher_select
<li class="publishercol">
	<a class="country_code" href="{root}ctrack.html?publisher={it.id}&tongue={tongue}">
		<span class="select_wrap publishername">{it.name}</span>
		<span class="select_wrap publisherid">{it.id}</span>
	</a>
</li> -->
#js_country_lookup
"{it.cc}":"{it.name}",
#jsmenu
<script>

    var publisher_names = {publisher_names_json};
    var iati_un_publishers = {iati_un_publishers};
    var country_names = {country_names_json};
    var crs_countries = {crs_countries_json};
    var sector = {sector};
    var total_projects = {total_projects};
    var active_projects = {active_projects};
    var total_budget = {total_budget};
    var total_expenditure = {total_expenditure};
    var total_un_agencies = {total_un_agencies};
    var un_agencies_in_iati = {un_agencies_in_iati};
    var un_trends = {un_trends};
    var un_org = {un_org};
    var geojson = {geojson};
    $(function () {

        $("#display-active-projects").text(active_projects);
        $("#display-un-agencies").text(un_agencies_in_iati);
        var reportings;
        var extraReporting;
        var countries;
        var sectors;

// default data in page so can display without any ajax
        countries = {rows: []};
        var rows = countries.rows;
        for (idx in crs_countries) {
            var name = country_names[idx];
            if (name) {
                rows.push({name: name, country_code: idx});
            }
        }
        rows.sort(function (a, b) {
            var ta = a.name.toUpperCase();
            var tb = b.name.toUpperCase();
            return (ta < tb) ? -1 : (ta > tb) ? 1 : 0;
        });

        var changeToMillions = function(number){
            var prettyNumber = "?";
            number = Math.round(number);

            var digits = new Number(number).toString().length;

            if(digits>6) {
                number = number/(1000000);
                prettyNumber = Math.round(number).toLocaleString() + ' M';
            } else {
                prettyNumber = new Number(number).toString();
            }

            return prettyNumber;
        }

        $("#total_projects_shown").html(total_projects.toLocaleString());
        $("#no_of_countries").html(countries.rows.length);
        $("#totalBudget").html("$" + changeToMillions(total_budget));
        $("#totalExpense").html("$" + changeToMillions(total_expenditure));
        $("#un_agencies_in_iati").html(un_agencies_in_iati);



        var un_org_total_project_each = {rows: []};
        var un_org_rows = un_org_total_project_each.rows;
        for(var defined_id in un_org){
            var id = defined_id;
            var total_proj = un_org[defined_id]['total_projects'];

            if(total_proj !== undefined) {
                un_org_rows.push({id:id,total_project: total_proj});
            }
            else{
                un_org_rows.push({id:id,total_project: 0});
            }
        }
        var sorted_un_rows = un_org_rows.sort(function (a,b){
            var ta = a.total_project;
            var tb = b.total_project;
            return (ta > tb) ? -1 : (ta < tb) ? 1 : 0;
        });

        var un_org_object = {};
        sorted_un_rows.forEach(function(b){
//            console.log(b.id + " : " + b.total_project);
             un_org_object[b.id] = parseInt(b.total_project);
        });

       var arr= Object.keys(un_org_object).sort(function(a,b){
           return (un_org_object[a] > un_org_object[b]) ? -1 : (un_org_object[a]<un_org_object[b]) ? 1 : 0;
        });

        extraReporting = {rows: []};

        var extraReportRows = extraReporting.rows;

        arr.forEach(function(k) {
            var name = iati_un_publishers[k];
            extraReportRows.push({name: name, reporting_ref: k});
        });

        reportings = {rows: []};

        var reportingRows = reportings.rows;
        for (idx in publisher_names) {
            if(arr.indexOf(idx) === -1){
                var name = publisher_names[idx];
                reportingRows.push({name: name, reporting_ref: idx});
            }
        }

        sectors = {rows: []};
        var rows = sectors.rows;
        for (idx in sector) {
            var name = sector[idx];
            rows.push({name: name, sector_ref: idx});
        }
        rows.sort(function (a, b) {
            var ta = a.name.toUpperCase();
            var tb = b.name.toUpperCase();
            return (ta < tb) ? -1 : (ta > tb) ? 1 : 0;
        });

// goto new url
        var change = function () {

            var name = "" + $("#sector_dropmenu select").val();
            if (name && (name != "")) {
                window.location.href = "{root}ctrack.html?sector=" + name + "&tongue={tongue}"
            }

            var name = "" + $("#country_dropmenu select").val();
            if (name && (name != "")) {
                window.location.href = "{root}ctrack.html?country=" + name + "&tongue={tongue}"
            }

        };

// fill in lists
        var refresh = function () {
            if (sectors) {
                var sectorList = $("#sector_list");
                sectorList.empty();

                var aa = [];
                aa.push("<select>");
                aa.push("<option value=''></option>");
                for (var i = 0; i < sectors.rows.length; i++) {
                    var v = sectors.rows[i];
                    if (v.sector_ref && v.name) // must be real publisher
                    {
                        var t = v.name
                        if (v.count) {
                            t = t + " (" + v.count + ") ";
                        }
                        var s = "<option value='" + v.sector_ref + "'>" + t + "</option>";
                        aa.push(s);
                    }
                }
                aa.push("</select>");
                $("#sector_dropmenu").html(aa.join(""));

                $("#sector_dropmenu select").change(change);
                $("#sector_dropmenu select").chosen({
                    search_contains: true,
                    "placeholder_text_single": "{publisher_dropmenu_text}"
                });

                for (var i = 0; i < sectors.rows.length; i++) {
                    var v = sectors.rows[i];
                    if (v.sector_ref && v.name) {
                        sectorList.append(
                                "	<li class=\"publishercol\">	" +
                                "	<a class=\"country_code\" href=\"{root}ctrack.html?sector=" + v.sector_ref + "&tongue={tongue}\"> " +
                                "			<span class=\"select_wrap publishername\">" + v.name + "</span>	" +
                                "	</a> " +
                                "	</li>		"
                        );

                    }
                }
            }
            if (extraReporting) {
                var un_publisher_list = $("#un_publisher_list");
                un_publisher_list.empty();

                for (var i = 0; i < extraReporting.rows.length; i++) {
                    var v = extraReporting.rows[i];
                    if (v.name && v.reporting_ref) {
                        un_publisher_list.append(
                                "  <li><a class=\"country_code\" href=\"{root}ctrack.html?publisher=" + v.reporting_ref + "&tongue={tongue}\">  " +
                                "<span class=\"publisher-logo\"><img src=\"{root}art/un_logos/" + v.reporting_ref +".png\" /></span>" +
                                "      <span class=\"publisher-name\">" + v.name.match(/\(([^)]+)\)/)[1]
                                + "</span>  " +
                                "    </a></li>  ");
                    }
                }

            }
            if (reportings) {
                var un_publisher_list = $("#un_publisher_list");

                for (var i = 0; i < reportings.rows.length; i++) {
                    var v = reportings.rows[i];
                    if (v.name && v.reporting_ref) {
                        un_publisher_list.append(
                                "  <li><a class=\"country_code noCursor\"> " +
                                "<span class=\"publisher-logo\"><img src=\"{root}art/un_logos/" + v.reporting_ref +".png\" /></span>" +
                                "      <span class=\"publisher-name\">" + v.name.match(/\(([^)]+)\)/)[1]
                                + "</span>  " +
                                " </a></li>  ");
                    }
                }

            }
            if (countries) {
                var cl = $('#country_menu_list');
                var aa = [];
                aa.push("<select>");
                aa.push("<option value=''></option>");
                for (var i = 0; i < countries.rows.length; i++) {
                    var v = countries.rows[i];
                    if (v.name) // must be real country
                    {
                        var t = (v.name || v.country_code )
                        if (v.count) {
                            t = t + " (" + v.count + ") ";
                        }
                        var s = "<option value='" + v.country_code + "'>" + t + "</option>";
                        aa.push(s);
                        cl.append('<li>' +
                                '<a class="country_code" href="{root}ctrack.html?country=' + v.country_code + '&tongue={tongue}">' +
                                '<span class="select_wrap">' +
                                '<img src="{root}art/flag/' + v.country_code.toLowerCase() + '.png" alt="' + v.name + '"/>' +
                                '</span>' +
                                '<span class="select_wrap countryid">' +
                                v.country_code +
                                '</span>' +
                                '<span class="select_wrap countryname">' +
                                v.name +
                                '</span>' +
                                '</a>' +
                                '</li>'
                        );
                    }
                }
                aa.push("</select>");
                $("#country_dropmenu").html(aa.join(""));

                $("#country_dropmenu select").change(change);
                $("#country_dropmenu select").chosen({
                    search_contains: true,
                    "placeholder_text_single": "{country_dropmenu_text}"
                });

            }
        };


// initialise page
        refresh();


    });

    //Flexslider
    (function () {

        // store the slider in a local variable
        var $window = $(window),
                flexslider;

        // tiny helper function to add breakpoints
        function getGridSize() {
            return (window.innerWidth < 600) ? 2 :
                    (window.innerWidth < 900) ? 3 : 4;
        }

        // $(function () {
        //     SyntaxHighlighter.all();
        // });

        $window.load(function () {
          $('.spinner').hide();
            $('.flexslider').flexslider({
                animation: "slide",
                animationLoop: false,
                itemWidth: 210,
                itemHeight: 145,
                itemMargin: 5,
                minItems: getGridSize(), // use function to pull in initial value
                maxItems: getGridSize() // use function to pull in initial value
            });
        });

        // check grid size on resize event
        $window.resize(function () {
            var gridSize = getGridSize();

            flexslider.vars.minItems = gridSize;
            flexslider.vars.maxItems = gridSize;
        });
    }());

</script>
